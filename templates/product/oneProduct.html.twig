{% extends 'base.html.twig' %}

{% block title %}{{ product.name }} - PinkKiwi Boutique{% endblock %}

{% block content %}
<div class="product-detail-page">
    <!-- Breadcrumb -->
    <nav aria-label="breadcrumb" class="mb-4">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="{{ path('home') }}">Home</a></li>
            <li class="breadcrumb-item"><a href="{{ path('products') }}">Products</a></li>
            <li class="breadcrumb-item active">{{ product.name }}</li>
        </ol>
    </nav>

    <!-- Product Info -->
    <div class="row mb-5">
        <!-- Image Gallery -->
        <div class="col-lg-6 mb-4">
            <div class="product-image-container">
                <img src="{{ product.picture }}" alt="{{ product.name }}" class="img-fluid rounded shadow-lg">
            </div>
        </div>

        <!-- Product Details -->
        <div class="col-lg-6">
            <div class="product-info">
                <span class="badge p-3 bg-secondary mb-3">{{ product.category.name }}</span>
                <h1 class="product-title">{{ product.name }}</h1>
                <p class="product-subtitle text-muted">{{ product.subtitle }}</p>

                <!-- Rating -->
                <div class="product-rating mb-3">
                    <div class="stars">
                        {% for i in 1..5 %}
                            {% if i <= product.getAvgRatings %}
                                <i class="fas fa-star text-warning"></i>
                            {% else %}
                                <i class="far fa-star text-warning"></i>
                            {% endif %}
                        {% endfor %}
                    </div>
                    <span class="text-muted ms-2">({{ product.comments|length }} review{{ product.comments|length > 1 ? 's' : '' }})</span>
                </div>

                <!-- Price -->
                <div class="product-price mb-4">
                    <span class="price">{{ (product.price/100)|number_format(2) }} â‚¬</span>
                </div>

                <!-- Description -->
                <div class="product-description mb-4">
                    <h5 class="fw-bold mb-3">Description</h5>
                    <div class="description-content">
                        {{ product.description|raw }}
                    </div>
                </div>

                <!-- Add to Cart -->
                <div class="d-grid gap-2">
                    <a href="{{ path('add_to_cart', {'id': product.id}) }}" class="btn btn-primary btn-lg">
                        <i class="fas fa-shopping-cart me-2"></i>Add to Cart
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Reviews Section -->
    <div class="reviews-section">
        <div class="section-header mb-4">
            <h2 class="section-title">Customer Reviews</h2>
            <div class="review-summary">
                <div class="average-rating">
                    <span class="rating-number">{{ product.getAvgRatings|number_format(1) }}</span>
                    <div class="stars">
                        {% for i in 1..5 %}
                            {% if i <= product.getAvgRatings %}
                                <i class="fas fa-star text-warning"></i>
                            {% else %}
                                <i class="far fa-star text-warning"></i>
                            {% endif %}
                        {% endfor %}
                    </div>
                    <p class="text-muted mb-0">Based on {{ product.comments|length }} review(s)</p>
                </div>
            </div>
        </div>

        {% if product.comments|length > 0 %}
            <div class="reviews-list">
                {% for comment in product.comments %}
                    <div class="review-card">
                        <div class="review-header">
                            <div class="reviewer-info">
                                <div class="reviewer-avatar">
                                    <i class="fas fa-user"></i>
                                </div>
                                <div>
                                    <h5 class="reviewer-name">{{ comment.user.firstName }} {{ comment.user.lastName }}</h5>
                                    <div class="review-rating">
                                        {% for i in 1..5 %}
                                            {% if i <= comment.rating %}
                                                <i class="fas fa-star text-warning"></i>
                                            {% else %}
                                                <i class="far fa-star text-warning"></i>
                                            {% endif %}
                                        {% endfor %}
                                    </div>
                                </div>
                            </div>
                            <span class="review-date text-muted">{{ comment.createdAt|date('d/m/Y') }}</span>
                        </div>
                        <div class="review-content">
                            <p>{{ comment.content|nl2br|striptags('<br>')|raw }}</p>
                        </div>
                    </div>
                {% endfor %}
            </div>
        {% else %}
            <div class="alert alert-info text-center">
                <i class="fas fa-comment-slash fa-2x mb-3"></i>
                <h5>No reviews yet</h5>
                <p class="mb-0">Be the first to review this product!</p>
            </div>
        {% endif %}
    </div>
</div>
{% endblock %}