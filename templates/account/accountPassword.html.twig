{% extends 'base.html.twig' %}

{% block title %}Change Password - PinkKiwi{% endblock %}

{% block content %}
<div class="password-page">
    {# Back Button #}
    <div class="text-end mb-3">
        <a href="{{ path('account') }}" class="btn btn-outline-secondary">
            <i class="fas fa-arrow-left me-2"></i>Back
        </a>
    </div>

    {# Header #}
    <div class="row mb-4">
        <div class="col-12 text-center">
            <h1 class="display-4 fw-bold section-title mb-2">
                <i class="fas fa-lock me-3"></i>Change Password
            </h1>
            <p class="lead text-muted">Secure your account with a new password</p>
        </div>
    </div>

    <div class="row justify-content-center">
        <div class="col-lg-10 col-xl-9">
            {# Security Info Card #}
            <div class="security-info-card mb-4">
                <div class="security-icon">
                    <i class="fas fa-shield-alt"></i>
                </div>
                <div class="security-content">
                    <h5 class="mb-2">Security Tips</h5>
                    <ul class="security-tips">
                        <li><i class="fas fa-check me-2"></i>Minimum 8 characters</li>
                        <li><i class="fas fa-check me-2"></i>Mix uppercase and lowercase</li>
                        <li><i class="fas fa-check me-2"></i>Add numbers and symbols</li>
                        <li><i class="fas fa-check me-2"></i>Avoid personal information</li>
                    </ul>
                </div>
            </div>

            {# Password Change Form #}
            <div class="password-form-card">
                <h3 class="form-card-title">
                    <i class="fas fa-key me-2"></i>Password Modification
                </h3>

                {{ form_start(form, {'attr': {'class': 'password-form'}}) }}

                {# Current User Info (disabled fields) #}
                <div class="user-info-section mb-4">
                    <h6 class="section-subtitle">
                        <i class="fas fa-user me-2"></i>Account Information
                    </h6>
                    <div class="row g-3">
                        <div class="col-md-6">
                            {{ form_row(form.firstName, {
                                'label': 'First Name',
                                'attr': {'class': 'form-control', 'readonly': true}
                            }) }}
                        </div>
                        <div class="col-md-6">
                            {{ form_row(form.lastName, {
                                'label': 'Last Name',
                                'attr': {'class': 'form-control', 'readonly': true}
                            }) }}
                        </div>
                        <div class="col-12">
                            {{ form_row(form.email, {
                                'label': 'Email',
                                'attr': {'class': 'form-control', 'readonly': true}
                            }) }}
                        </div>
                    </div>
                </div>

                <hr class="my-4">

                {# Password Fields #}
                <div class="password-fields-section">
                    <h6 class="section-subtitle">
                        <i class="fas fa-lock me-2"></i>New Password
                    </h6>
                    
                    {# Old Password #}
                    <div class="mb-3">
                        <label class="form-label fw-bold">
                            <i class="fas fa-key me-2"></i>Current Password
                        </label>
                        {{ form_widget(form.oldPassword, {
                            'attr': {
                                'class': 'form-control form-control-lg',
                                'placeholder': 'Enter your current password'
                            }
                        }) }}
                        <small class="text-muted">Required to verify your identity</small>
                    </div>

                    {# New Password #}
                    <div class="mb-3">
                        <label class="form-label fw-bold">
                            <i class="fas fa-lock me-2"></i>New Password
                        </label>
                        {{ form_widget(form.newPassword, {
                            'attr': {
                                'class': 'form-control form-control-lg',
                                'placeholder': 'Enter your new password'
                            }
                        }) }}
                        <small class="text-muted">Minimum 8 characters recommended</small>
                    </div>

                    {# Confirm New Password #}
                    <div class="mb-4">
                        <label class="form-label fw-bold">
                            <i class="fas fa-check-circle me-2"></i>Confirm Password
                        </label>
                        {{ form_widget(form.confirmNewPassword, {
                            'attr': {
                                'class': 'form-control form-control-lg',
                                'placeholder': 'Confirm your new password'
                            }
                        }) }}
                        <small class="text-muted">Must match the new password</small>
                    </div>

                    {# Submit Button #}
                    <div class="d-grid gap-2">
                        {{ form_widget(form.submit, {
                            'label': 'Save New Password',
                            'attr': {'class': 'btn btn-primary btn-lg'}
                        }) }}
                    </div>
                </div>

                {{ form_end(form) }}
            </div>

            {# Additional Security Info #}
            <div class="alert alert-info mt-4">
                <i class="fas fa-info-circle me-2"></i>
                <strong>Note:</strong> After changing your password, you will be logged out and will need to log in again with your new password.
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block javascript %}
<script>
// Password strength indicator
document.addEventListener('DOMContentLoaded', function() {
    const newPasswordInput = document.querySelector('input[name="change_password[newPassword]"]');
    const confirmPasswordInput = document.querySelector('input[name="change_password[confirmNewPassword]"]');
    
    if (newPasswordInput && confirmPasswordInput) {
        // Check if passwords match
        confirmPasswordInput.addEventListener('input', function() {
            if (this.value && newPasswordInput.value) {
                if (this.value === newPasswordInput.value) {
                    this.classList.remove('is-invalid');
                    this.classList.add('is-valid');
                } else {
                    this.classList.remove('is-valid');
                    this.classList.add('is-invalid');
                }
            }
        });
    }
});
</script>
{% endblock %}