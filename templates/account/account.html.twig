{% extends 'base.html.twig' %}

{% block title %}My Account - {{ app.user.firstName }}{% endblock %}

{% block content %}
<div class="account-page">
	{# Welcome Header #}
	<div class="account-header">
		<div class="account-welcome-icon">
			<i class="fas fa-user-circle"></i>
		</div>
		<h1>Welcome, {{ app.user.firstName }} {{ app.user.lastName }}!</h1>
		<p><i class="fas fa-envelope me-2"></i>{{ app.user.email }}</p>
	</div>

	{# Dashboard with Stats #}
	<div class="stats-grid">
		{% include 'components/account/stat_card.html.twig' with {
		'icon': 'fa-shopping-bag',
		'title': 'My Orders',
		'value': orders|length,
		'color': 'primary',
		'subtitle': orders|length > 0 ? 'Validated order' ~ (orders|length > 1 ? 's' : '') : 'No orders'
		} %}

		{# Loyalty status based on number of orders #}
		{% set loyaltyStatus = orders|length == 0 ? 'New' : (orders|length < 3 ? 'Bronze' : (orders|length < 5
			? 'Silver' : 'Gold' )) %} {% set loyaltyIcon=orders|length==0 ? 'üå±' : (orders|length < 3 ? 'ü•â' :
			(orders|length < 5 ? 'ü•à' : 'ü•á' )) %} {% include 'components/account/stat_card.html.twig' with { 'icon'
			: 'fa-star' , 'title' : 'My Loyalty' , 'value' : loyaltyIcon ~ ' ' ~ loyaltyStatus, 'color' : 'warning'
			, 'subtitle' : orders|length> 0 ? orders|length ~ ' validated order' ~ (orders|length > 1 ? 's' : '') :
			'Start your adventure!'
			} %}

			{# Coupons (currently 0, to implement later) #}
			{% set coupons = 0 %}

			{% include 'components/account/stat_card.html.twig' with {
			'icon': 'fa-ticket-alt',
			'title': 'Coupons',
			'value': coupons,
			'color': 'success',
			'subtitle': coupons > 0 ? 'Available now!' : 'Coming soon!'
			} %}

			{% include 'components/account/stat_card.html.twig' with {
			'icon': 'fa-comments',
			'title': 'My Reviews',
			'value': app.user.comments|length,
			'color': 'warning',
			'subtitle': 'Review' ~ (app.user.comments|length > 1 ? 's' : '') ~ ' left'
			} %}
	</div>

	{# Tab Navigation #}
	{% include 'components/account/nav_tabs.html.twig' with {
	'tabs': [
	{'id': 'infos', 'label': 'My Information', 'icon': 'fa-user', 'active': true},
	{'id': 'orders', 'label': 'My Orders', 'icon': 'fa-shopping-bag', 'active': false},
	{'id': 'addresses', 'label': 'My Addresses', 'icon': 'fa-map-marker-alt', 'active': false},
	{'id': 'security', 'label': 'Security', 'icon': 'fa-lock', 'active': false}
	]
	} %}

	{# Tab Content #}
	<div class="tab-content">
		{# Tab: My Information #}
		<div class="tab-pane fade show active" id="infos" role="tabpanel">
			<h3><i class="fas fa-user me-2"></i>Personal Information</h3>

			{% include 'components/account/info_section.html.twig' with {
			'title': 'Account information',
			'icon': 'fa-id-card',
			'items': [
			{'label': 'First Name', 'value': app.user.firstName},
			{'label': 'Last Name', 'value': app.user.lastName},
			{'label': 'Email', 'value': app.user.email},
			{'label': 'Account Status', 'value': app.user.active ? 'Active ‚úÖ' : 'Inactive ‚ùå'}
			]
			} %}

			<div class="quick-actions">
				<a href="{{ path('account_address') }}" class="quick-action-card">
					<i class="fas fa-map-marker-alt"></i>
					<h4>Manage addresses</h4>
				</a>
				<a href="{{ path('account_password') }}" class="quick-action-card">
					<i class="fas fa-key"></i>
					<h4>Change password</h4>
				</a>
				<a href="{{ path('account_order') }}" class="quick-action-card">
					<i class="fas fa-box"></i>
					<h4>View orders</h4>
				</a>
			</div>
		</div>

		{# Tab: My Orders #}
		<div class="tab-pane fade" id="orders" role="tabpanel">
			<h3><i class="fas fa-shopping-bag me-2"></i>Order History</h3>

			{% if orders|length == 0 %}
			<div class="empty-state">
				<i class="fas fa-shopping-cart"></i>
				<h4>No orders yet</h4>
				<p>You haven't placed any orders yet.</p>
				<a href="{{ path('products') }}" class="btn btn-primary btn-lg">
					Discover our products
				</a>
			</div>
			{% else %}
			<div class="table-responsive">
				<table class="table table-hover">
					<thead>
						<tr>
							<th>Reference</th>
							<th>Date</th>
							<th>Products</th>
							<th>Total</th>
							<th>Status</th>
							<th></th>
						</tr>
					</thead>
					<tbody>
						{% for order in orders %}
						<tr>
							<td><span class="badge bg-secondary">{{ order.reference }}</span></td>
							<td>{{ order.createdAt|date("m/d/Y") }}</td>
							<td>{{ order.orderDetails|length }} item{{ order.orderDetails|length > 1 ? 's' : '' }}
							</td>
							<td class="fw-bold">{{ ((order.carrier.price + order.total) / 100)|number_format(2, '.',
								',') }} ‚Ç¨</td>
							<td>
								<span class="badge bg-success">
									<i class="fas fa-check-circle me-1"></i>Paid
								</span>
							</td>
							<td>
								<a href="{{ path('account_order_show', {'reference': order.reference}) }}"
									class="btn btn-outline-primary">
									<i class="fas fa-eye me-1"></i>View
								</a>
							</td>
						</tr>
						{% endfor %}
					</tbody>
				</table>
			</div>
			{% endif %}
		</div>

		{# Tab: My Addresses #}
		<div class="tab-pane fade" id="addresses" role="tabpanel">
			<h3><i class="fas fa-map-marker-alt me-2"></i>Delivery Addresses</h3>

			{% if app.user.addresses|length == 0 %}
			<div class="empty-state">
				<i class="fas fa-map-marked-alt"></i>
				<h4>No saved addresses</h4>
				<p>Add a delivery address to make ordering easier.</p>
				<a href="{{ path('account_address') }}" class="btn btn-primary btn-lg">
					<i class="fas fa-plus me-2"></i>Add address
				</a>
			</div>
			{% else %}
			<div class="alert alert-info d-flex align-items-center mb-4">
				<i class="fas fa-info-circle fa-2x me-3"></i>
				<div>
					<h5 class="alert-heading mb-1">{{ app.user.addresses|length }} saved address{{
						app.user.addresses|length > 1 ? 'es' : '' }}</h5>
					<p class="mb-0">Manage your delivery addresses on the dedicated page.</p>
				</div>
			</div>

			<div class="text-center py-5">
				<i class="fas fa-map-marked-alt fa-4x text-primary mb-4" style="opacity: 0.3;"></i>
				<h4 class="mb-3">Your addresses are ready</h4>
				<p class="text-muted mb-4">View and edit your delivery addresses</p>
				<a href="{{ path('account_address') }}" class="btn btn-primary btn-lg">
					<i class="fas fa-cog me-2"></i>Manage addresses
				</a>
			</div>
			{% endif %}
		</div>

		{# Tab: Security #}
		<div class="tab-pane fade" id="security" role="tabpanel">
			<h3><i class="fas fa-lock me-2"></i>Account Security</h3>

			{% include 'components/account/info_section.html.twig' with {
			'title': 'Password',
			'icon': 'fa-key',
			'editUrl': path('account_password'),
			'editText': 'Change',
			'items': [
			{'label': 'Last changed', 'value': 'A few months ago'},
			{'label': 'Security', 'value': '‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢'}
			]
			} %}

			<div class="alert alert-info d-flex align-items-center mt-4">
				<i class="fas fa-info-circle fa-2x me-3"></i>
				<div>
					<h5 class="alert-heading mb-1">Security tip</h5>
					<p class="mb-0">Change your password regularly and use a strong password with letters, numbers and
						special characters.</p>
				</div>
			</div>
		</div>
	</div>
</div>
{% endblock %}