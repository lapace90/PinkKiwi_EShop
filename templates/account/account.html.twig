{% extends 'base.html.twig' %}

{% block title %}Mon Compte - {{ app.user.firstName }}{% endblock %}

{% block content %}
<div class="account-page">
	{# Header de bienvenue #}
	<div class="account-header">
		<div class="account-welcome-icon">
			<i class="fas fa-user-circle"></i>
		</div>
		<h1>Bienvenue, {{ app.user.firstName }} {{ app.user.lastName }}!</h1>
		<p><i class="fas fa-envelope me-2"></i>{{ app.user.email }}</p>
	</div>

{# Dashboard avec statistiques #}
    <div class="stats-grid">
        {% include 'components/account/stat_card.html.twig' with {
            'icon': 'fa-shopping-bag',
            'title': 'Mes Commandes',
            'value': orders|length,
            'color': 'primary',
            'subtitle': orders|length > 0 ? 'Commande' ~ (orders|length > 1 ? 's' : '') ~ ' valid√©e' ~ (orders|length > 1 ? 's' : '') : 'Aucune commande'
        } %}

        {# Statut de fid√©lit√© bas√© sur le nombre de commandes #}
        {% set loyaltyStatus = orders|length == 0 ? 'Nouveau' : (orders|length < 3 ? 'Bronze' : (orders|length < 5 ? 'Argent' : 'Or')) %}
        {% set loyaltyIcon = orders|length == 0 ? 'üå±' : (orders|length < 3 ? 'ü•â' : (orders|length < 5 ? 'ü•à' : 'ü•á')) %}
        
        {% include 'components/account/stat_card.html.twig' with {
            'icon': 'fa-star',
            'title': 'Ma Fid√©lit√©',
            'value': loyaltyIcon ~ ' ' ~ loyaltyStatus,
            'color': 'warning',
            'subtitle': orders|length > 0 ? orders|length ~ ' commande' ~ (orders|length > 1 ? 's' : '') ~ ' valid√©e' ~ (orders|length > 1 ? 's' : '') : 'Commencez votre aventure!'
        } %}

        {# Bons de r√©duction (pour l'instant 0, √† impl√©menter plus tard) #}
        {% set coupons = 0 %}
        
        {% include 'components/account/stat_card.html.twig' with {
            'icon': 'fa-ticket-alt',
            'title': 'Bons de R√©duction',
            'value': coupons,
            'color': 'success',
            'subtitle': coupons > 0 ? 'Utilisable' ~ (coupons > 1 ? 's' : '') ~ ' maintenant!' : 'Bient√¥t disponible!'
        } %}

		{% include 'components/account/stat_card.html.twig' with {
		'icon': 'fa-comments',
		'title': 'Mes Avis',
		'value': app.user.comments|length,
		'color': 'warning',
		'subtitle': 'Avis laiss√©' ~ (app.user.comments|length > 1 ? 's' : '')
		} %}
    </div>

	{# Navigation par onglets #}
	{% include 'components/account/nav_tabs.html.twig' with {
	'tabs': [
	{'id': 'infos', 'label': 'Mes Informations', 'icon': 'fa-user', 'active': true},
	{'id': 'orders', 'label': 'Mes Commandes', 'icon': 'fa-shopping-bag', 'active': false},
	{'id': 'addresses', 'label': 'Mes Adresses', 'icon': 'fa-map-marker-alt', 'active': false},
	{'id': 'security', 'label': 'S√©curit√©', 'icon': 'fa-lock', 'active': false}
	]
	} %}

	{# Contenu des onglets #}
	<div class="tab-content">
		{# Onglet: Mes Informations #}
		<div class="tab-pane fade show active" id="infos" role="tabpanel">
			<h3><i class="fas fa-user me-2"></i>Mes Informations Personnelles</h3>

			{% include 'components/account/info_section.html.twig' with {
			'title': 'Informations de compte',
			'icon': 'fa-id-card',
			'items': [
			{'label': 'Pr√©nom', 'value': app.user.firstName},
			{'label': 'Nom', 'value': app.user.lastName},
			{'label': 'Email', 'value': app.user.email},
			{'label': 'Statut du compte', 'value': app.user.active ? 'Actif ‚úÖ' : 'Inactif ‚ùå'}
			]
			} %}

			<div class="quick-actions">
				<a href="{{ path('account_address') }}" class="quick-action-card">
					<i class="fas fa-map-marker-alt"></i>
					<h4>G√©rer mes adresses</h4>
				</a>
				<a href="{{ path('account_password') }}" class="quick-action-card">
					<i class="fas fa-key"></i>
					<h4>Modifier mon mot de passe</h4>
				</a>
				<a href="{{ path('account_order') }}" class="quick-action-card">
					<i class="fas fa-box"></i>
					<h4>Voir mes commandes</h4>
				</a>
			</div>
		</div>

		{# Onglet: Mes Commandes #}
		<div class="tab-pane fade" id="orders" role="tabpanel">
			<h3><i class="fas fa-shopping-bag me-2"></i>Historique de mes commandes</h3>

			{% if orders|length == 0 %}
			<div class="empty-state">
				<i class="fas fa-shopping-cart"></i>
				<h4>Aucune commande pour le moment</h4>
				<p>Vous n'avez pas encore pass√© de commande.</p>
				<a href="{{ path('products') }}" class="btn btn-primary btn-lg">
					{# <i class="fas fa-shopping-bag me-2"></i> #}
					D√©couvrir nos produits
				</a>
			</div>
			{% else %}
			<div class="table-responsive">
				<table class="table table-hover">
					<thead>
						<tr>
							<th>R√©f√©rence</th>
							<th>Date</th>
							<th>Produits</th>
							<th>Total</th>
							<th>Statut</th>
							<th></th>
						</tr>
					</thead>
					<tbody>
						{% for order in orders %}
						<tr>
							<td><span class="badge bg-secondary">{{ order.reference }}</span></td>
							<td>{{ order.createdAt|date("d/m/Y") }}</td>
							<td>{{ order.orderDetails|length }} article{{ order.orderDetails|length > 1 ? 's' : '' }}
							</td>
							<td class="fw-bold">{{ ((order.carrier.price + order.total) / 100)|number_format(2, ',', '
								') }} ‚Ç¨</td>
							<td>
								<span class="badge bg-success">
									<i class="fas fa-check-circle me-1"></i>Pay√©e
								</span>
							</td>
							<td>
								<a href="{{ path('account_order_show', {'reference': order.reference}) }}"
									class="btn btn-outline-primary">
									<i class="fas fa-eye me-1"></i>Voir
								</a>
							</td>
						</tr>
						{% endfor %}
					</tbody>
				</table>
			</div>
			{% endif %}
		</div>

		{# Onglet: Mes Adresses #}
		<div class="tab-pane fade" id="addresses" role="tabpanel">
			<h3><i class="fas fa-map-marker-alt me-2"></i>Mes Adresses de livraison</h3>

			{% if app.user.addresses|length == 0 %}
			<div class="empty-state">
				<i class="fas fa-map-marked-alt"></i>
				<h4>Aucune adresse enregistr√©e</h4>
				<p>Ajoutez une adresse de livraison pour faciliter vos commandes.</p>
				<a href="{{ path('account_address') }}" class="btn btn-primary btn-lg">
					<i class="fas fa-plus me-2"></i>Ajouter une adresse
				</a>
			</div>
			{% else %}
			<div class="alert alert-info d-flex align-items-center mb-4">
				<i class="fas fa-info-circle fa-2x me-3"></i>
				<div>
					<h5 class="alert-heading mb-1">{{ app.user.addresses|length }} adresse{{ app.user.addresses|length >
						1 ? 's' : '' }} enregistr√©e{{ app.user.addresses|length > 1 ? 's' : '' }}</h5>
					<p class="mb-0">G√©rez vos adresses de livraison sur la page d√©di√©e.</p>
				</div>
			</div>

			<div class="text-center py-5">
				<i class="fas fa-map-marked-alt fa-4x text-primary mb-4" style="opacity: 0.3;"></i>
				<h4 class="mb-3">Vos adresses sont pr√™tes</h4>
				<p class="text-muted mb-4">Consultez et modifiez vos adresses de livraison</p>
				<a href="{{ path('account_address') }}" class="btn btn-primary btn-lg">
					<i class="fas fa-cog me-2"></i>G√©rer mes adresses
				</a>
			</div>
			{% endif %}
		</div>

		{# Onglet: S√©curit√© #}
		<div class="tab-pane fade" id="security" role="tabpanel">
			<h3><i class="fas fa-lock me-2"></i>S√©curit√© de mon compte</h3>

			{% include 'components/account/info_section.html.twig' with {
			'title': 'Mot de passe',
			'icon': 'fa-key',
			'editUrl': path('account_password'),
			'editText': 'Modifier',
			'items': [
			{'label': 'Dernier changement', 'value': 'Il y a quelques mois'},
			{'label': 'S√©curit√©', 'value': '‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢'}
			]
			} %}

			<div class="alert alert-info d-flex align-items-center mt-4">
				<i class="fas fa-info-circle fa-2x me-3"></i>
				<div>
					<h5 class="alert-heading mb-1">Conseil de s√©curit√©</h5>
					<p class="mb-0">Changez r√©guli√®rement votre mot de passe et utilisez un mot de passe fort avec des
						lettres, chiffres et caract√®res sp√©ciaux.</p>
				</div>
			</div>
		</div>
	</div>
</div>
{% endblock %}